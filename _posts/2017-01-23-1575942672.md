---
layout: post
title: Exitmap：Tor出口中继节点扫描器
categories:
- Pocket
tags:
---
原文地址：http://mp.weixin.qq.com/s/CInDeHfwZG1jpo55nMuziQ

收藏时间：2017-01-23 09:41:50

<div  lang="zh">
                <div id="img-content" class="rich_media_area_primary" nodeIndex="6">
                    
                    <p class="profile_meta _RIL_KEEPER_CLASS_" nodeIndex="11">
                                <label class="profile_meta_label">微信号</label>
                                <span class="profile_meta_value">freebuf</span>
                                </p><p class="profile_meta _RIL_KEEPER_CLASS_" nodeIndex="12">
                                <label class="profile_meta_label">功能介绍</label>
                                <span class="profile_meta_value">国内关注度最高的全球互联网安全新媒体</span>
                                </p>
                    
                    
                    
                    
                                                            
                                                            
                    
                    <div class="rich_media_content " id="js_content" nodeIndex="13">
                        
                       
                        

                        
                        
                        <p class=" _RIL_KEEPER_CLASS_" nodeIndex="14"><span nodeIndex="88"><strong class=" _RIL_KEEPER_CLASS_" nodeIndex="89"><span nodeIndex="90">工具简介</span></strong></span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="15"><strong class=" _RIL_KEEPER_CLASS_" nodeIndex="91"><span nodeIndex="92">Exitmap是一个基于Python的Tor出口中继节点扫描器，具有快速和模块化的特点。 Exitmap模块执行在所有出口中继节点（的子集）上运行的任务。如果你有函数式编程的知识背景，可以把Exitmap看作是Tor出口中继节点的map（）接口。</span></strong></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="16"><strong class=" _RIL_KEEPER_CLASS_" nodeIndex="93"><span nodeIndex="94"><div id="RIL_IMG_1" class="RIL_IMG"><img src="/media/posts_images/2017-01-23-1575942672/1"/></div></span></strong><strong class=" _RIL_KEEPER_CLASS_" nodeIndex="95"><span nodeIndex="96"><br nodeIndex="97"></span></strong></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="17"><span nodeIndex="98">这些模块可以执行任何基于TCP的网络任务，例如获取网页、上传文件、连接到SSH服务器或加入IRC频道（Internet Relay Chat，互联网中继聊天，它是由芬兰人Jarkko Oikarinen于1988年首创的一种网络聊天协议）。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="18"><span nodeIndex="99">Exitmap的实际功能是监测出口中继节点的可靠性。当然很多人会利用Exitmap在Tor项目的检查服务中检查误报情况，并发现恶意的出口中继节点。为Exitmap开发新的模块也非常便捷，只需查看doc或目录中的HACKING文件，或者查看其中一个现有模块即可。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="19"><span nodeIndex="100">Exitmap使用Stem为所有给定的出口中继节点创建线路，并且一旦tor向Exitmap发出线路已建立的通知，Exitmap就会为新建立的线路调用模块。模块可以是纯Python脚本，也可以是可执行文件。对于可执行文件则需要用到torsocks工具。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="20"><span nodeIndex="101">最后请注意Exitmap是一个网络评估工具，对普通的Tor用户没有用。Tor项目正在定期运行该工具，过多的Exitmap扫描只会导致额外的网络负载。Exitmap之所以开源是因为有人可能会对其源代码和结构感兴趣。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="21"><span nodeIndex="102">安装 </span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="22"><span nodeIndex="103">Exitmap使用Stem库（Tor的python控制器库）与Tor进行交互。安装Stem的方式很多，最简单的应该是使用pip与现有的requirements.txt文件结合：</span></p><blockquote nodeIndex="23"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="24"><span nodeIndex="104">$ pip install -r requirements.txt</span></p></blockquote><p class=" _RIL_KEEPER_CLASS_" nodeIndex="25"><span nodeIndex="105">运行Exitmap</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="26"><span nodeIndex="106">Exitmap所需的唯一参数是模块名称。例如，你可以通过以下方式运行Exitmap的checktest模块：</span></p><blockquote nodeIndex="27"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="28"><span nodeIndex="107">$ ./bin/exitmap checktest</span></p></blockquote><p class=" _RIL_KEEPER_CLASS_" nodeIndex="29"><span nodeIndex="108">然后命令行输出将显示如何进行Tor bootstrap，checktest模块输出和扫描摘要。如果你不需要3个hops，倾向于使用在静态的第一个hop之后的两个hops,请运行：</span></p><blockquote nodeIndex="30"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="31"><span nodeIndex="109">$ ./bin/exitmap --first-hop CCEF02AA454C0AB0FE1AC68304F6D8C4220C1912 checktest</span></p></blockquote><p class=" _RIL_KEEPER_CLASS_" nodeIndex="32"><span nodeIndex="110">若在德国出口中继节点上运行同样的测试，请执行：</span></p><blockquote nodeIndex="33"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="34"><span nodeIndex="111">$ ./bin/exitmap --country DE --first-hop CCEF02AA454C0AB0FE1AC68304F6D8C4220C1912 checktest</span></p></blockquote><p class=" _RIL_KEEPER_CLASS_" nodeIndex="35"><span nodeIndex="112">如果要在线路创建之间暂停五秒钟以减少Tor网络和扫描目标的负载，请运行：</span></p><blockquote nodeIndex="36"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="37"><span nodeIndex="113">$ ./</span><span nodeIndex="114">bin/exitmap --build-delay 5 checktest</span></p></blockquote><p class=" _RIL_KEEPER_CLASS_" nodeIndex="38"><span nodeIndex="115">注意：</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="39"><span nodeIndex="116">CCEF02AA454C0AB0FE1AC68304F6D8C4220C1912是一个由瑞典卡尔斯塔德大学运行的出口节点，你可以自由使用。但是分配扫描负载时请尽量使用自己的出口中继节点。 </span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="40"><span nodeIndex="117">若想看到Exitmap的其它选项，请运行：</span></p><blockquote nodeIndex="41"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="42"><span nodeIndex="118">$ ./bin/exitmap --help</span></p></blockquote><p class=" _RIL_KEEPER_CLASS_" nodeIndex="43"><strong class=" _RIL_KEEPER_CLASS_" nodeIndex="119"><span nodeIndex="120">功能</span></strong></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="44"><span nodeIndex="121">Exitmap包含以下模块：</span><br nodeIndex="122"></p><blockquote nodeIndex="45"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="46"><span nodeIndex="123">testfds：测试某出口中继节点是否能够获取简单网页的内容。若不能则说明该出口中继节点可能没有足够可用的文件描述符（打开一个文件需要维护很多数据，不光是权限的问题，内核对每一个打开文件都分配了一个数据结构，而文件描述符则是指向这些数据结构的索引，内核可以通过一个文件描述符查到相应文件的数据）。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="47"><span nodeIndex="124">checktest：尝试发现Tor项目检查服务中的误报。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="48"><span nodeIndex="125">dnspoison：尝试解析多个域名，并将接收到的DNS A记录与预期记录进行比较。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="49"><span nodeIndex="126">dnssec：检测解析器不证实DNSSEC（DNS安全扩展）的出口中继节点。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="50"><span nodeIndex="127">patchingCheck：检查是否存在文件篡改。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="51"><span nodeIndex="128">cloudflared：检查网站是否返回CloudFlare的验证码。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="52"><span nodeIndex="129">rtt：测量从某出口到各个目的地的往返时间。</span></p></blockquote><p class=" _RIL_KEEPER_CLASS_" nodeIndex="53"><br nodeIndex="130"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="54"><strong class=" _RIL_KEEPER_CLASS_" nodeIndex="131"><span nodeIndex="132">配置</span></strong></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="55"><span nodeIndex="133">默认状态下，Exitmap会读取你的主目录中的.exitmaprc文件。该文件能够接受所有命令行选项，但是你必须用下划线代替减号。例如：</span></p><blockquote nodeIndex="56"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="57"><span nodeIndex="134">[Defaults]</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="58"><span nodeIndex="135">first_hop = CCEF02AA454C0AB0FE1AC68304F6D8C4220C1912</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="59"><span nodeIndex="136">verbosity = debug</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="60"><span nodeIndex="137">build_delay = 1</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="61"><span nodeIndex="138">analysis_dir = /path/to/exitmap_scans</span></p></blockquote><p class=" _RIL_KEEPER_CLASS_" nodeIndex="62"><br nodeIndex="139"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="63"><strong class=" _RIL_KEEPER_CLASS_" nodeIndex="140"><span nodeIndex="141">测试</span></strong></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="64"><span nodeIndex="142">在提交代码合并请求之前，通过运行以下程序来确认所有配置均已通过测试：</span></p><blockquote nodeIndex="65"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="66"><span nodeIndex="143">$ pip install -r requirements-dev.txt</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="67"><span nodeIndex="144">$ py.test --cov-report term-missing --cov-config .coveragerc --cov=src test</span></p></blockquote><p class=" _RIL_KEEPER_CLASS_" nodeIndex="68"><span nodeIndex="145">Exitmap下载链接请见原文</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="69"><span nodeIndex="146">若对Exitmap的使用存在任何问题，可联系Philipp Winter phw@nymity.ch</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="70"><span nodeIndex="147">*参考来源：github，FB小编Carrie编译，转载请注明来自FreeBuf</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="71"><div id="RIL_IMG_2" class="RIL_IMG"><img src="/media/posts_images/2017-01-23-1575942672/2"/></div></p>
                    </div>
                    <p id="js_preview_reward_wording" class="tips_global reward_tips _RIL_KEEPER_CLASS_" nodeIndex="74"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="75">
                            <a class="reward_access" id="js_preview_reward_link" href="">赞赏</a>
                        </p></div><p class="discuss_icon_tips rich_split_tips tr _RIL_KEEPER_CLASS_" nodeIndex="83" childisonlyalink="1">
                        <a href="" id="js_preview_cmt_write">写留言<div id="RIL_IMG_3" class="RIL_IMG"><img src="/media/posts_images/2017-01-23-1575942672/3"/></div></a>
                      </p></div>