---
layout: post
title: "Wi-Fi新型攻击来了！注意"
categories:
- 今日头条
tags:
---
过去的网络攻击方式主要是PC端的攻击，通过木马传播的方式感染目标主机，窃取用户隐私信息。而随着WiFi技术的成熟，公司、家庭中的WiFi应用越来越广泛，随之而来针对WiFi的攻击也越来越多。

![](http://p1.pstatp.com/large/149f000012b2f0e40b1f)

近期，安全研究人员发现了一种新型安卓木马，该木马通过仿冒某种WiFi软件的方式，在用户安装运行程序后，通过暴力破解路由器Web管理界面的用户名和密码，在成功后登录后，修改DNS到指定的地址，劫持流量。

![](http://p3.pstatp.com/large/149a0003f70b5b8e96ab)

木马“伪装者”

![](http://p1.pstatp.com/large/14210008050017549d06)

该木马的恶意样本特征为：『http://admin:admin@/|http://admin:123456』。在获取到恶意木马特征后，我们在Janus平台检索到以下四个应用样本。

![](http://p3.pstatp.com/large/149b000012acad281771)

『恶意应用样本』

这几个恶意样本伪装成“正常”应用的样子，看起来和官方应用也没什么不同。但是仔细观察可以发现一些不同。

第一款恶意木马的应用名为“万能钥匙”，而官方应用的应用名为“WiFi万能钥匙”。除了应用名不同外，开发者、包名、证书SHA1也不同，开发者对包名也进行了仿冒。我们对该应用的开发者、包名和证书SHA1进行了检索，结果仍是上面的三款应用。

![](http://p3.pstatp.com/large/149a0003f70d83d7f169)

『WiFi万能钥匙样本对比』

第二款恶意木马的应用名为“百度一下”，而官方应用的应用名为“百度”，“手机百度”。这款应用仿冒的内容更加逼真，开发者与官方应用的开发者也一样，包名和证书是仿冒的。对包名、证书SHA1的检索结果仍然只有这一个应用程序。

![](http://p3.pstatp.com/large/149e00026a51003671ac)

『手机百度样本对比』

到这里，已经很明显可以看出这是仿冒应用了，接下来就是对这两款仿冒应用程序进行深度分析及溯源分析。

![](http://p3.pstatp.com/large/149a0003f70b5b8e96ab)

“万能钥匙”开启谁的大门

![](http://p1.pstatp.com/large/14210008050017549d06)

0x01 找到“万能钥匙”源头

“万能钥匙”的深度分析结果显示，该程序内部涉及6个ip，29个域名。通过对域名的筛选，其中有一个“奇怪”的域名，“www.dochtm.com”。

在浏览器中打开URL，发现这个一个伪造的“官网”，伪造者命名该应用为“WiFi万能钥匙显密码版”。

![](http://p1.pstatp.com/large/141d00063503d6ad8b83)

『“官网”截图』

在该“官网”下载该应用，Chrome提示该应用“可能存在危险”，可想而知，Google已经知道这个应用程序可能存在恶意行为。

![](http://p1.pstatp.com/large/149f000012b569b48fbf)

『Chrome下载提示信息』

所谓“官网”仍旧可以打开，应用未下线，而距离该木马病毒被暴露已经有一段时间了，这也说明仍旧有设备被感染，该恶意木马仍旧在肆意传播。

0x02 病毒何时起肆虐

有了“官网”，一切似乎好玩了起来。

第一步，whois信息查询

whois信息查询，该域名从2013年10月31日就已经注册了。但是这些信息并不能看出该恶意程序是什么时候开始正式上线的。

![](http://p3.pstatp.com/large/149a0003f70eb74850b2)

『whois信息查询结果』

第二步，threatbook查询

在threatbook中进行域名查询，发现在2016年11月3号该apk已经被标记为可疑。

![](http://p1.pstatp.com/large/149a0003f70fd61377db)

『threatbook信息查询结果』

恶意程序会修改DNS到以下几个ip地址：

101.200.147.153112.33.13.11120.76.249.59

在threatbook中搜索这几个关键ip地址，最早在2016年12月28日有标记“恶意程序”和“远控”，在2016年12月29日有用户标记ip为“恶意DNS服务器”

![](http://p1.pstatp.com/large/149a0003f71012132bab)

![](http://p3.pstatp.com/large/149b000012ad665db459)

『ip标注信息』

第三步，快照信息查询

通过网站历史快照查询的方式，我们可以看到一些该网站运营以来的历史数据，该网站从14年末开始活跃，但是从快照来看，到2016年10月1号才开始有“WiFi万能钥匙显密码版”的相关信息存在。

![](http://p3.pstatp.com/large/142100080501a6b0898f)

『网站历史活跃信息』

![](http://p1.pstatp.com/large/149b000012ae8a03557e)

『2016年10月1日网站快照页面』

这说明，至少从10月1号开始，这个网站已经开始传播其恶意程序提供下载了，但是这并不能精准的判断它的生存周期。可以大致判断，这个恶意应用程序从10月1号开始，到12月末，已经至少上线运行了3个月之久。

0x03 幕后黑手做了什么？

这个恶意程序会不断尝试用常用的用户名、密码登陆路由器Web管理端。通过在Janus分析平台搜索admin关键字，可以在第1426行看到所有进行尝试的用户名和密码。

![](http://p3.pstatp.com/large/149b000012b06f69cb78)

『程序代码分析』

所有的用户名、密码关键字为：

http://admin:admin@\u7f51\u5173/|http://admin:123456@\u7f51\u5173/|http://admin:\u5bc6\u7801@\u7f51\u5173/|http://admin:12345678@\u7f51\u5173/|http://admin:123456789@\u7f51\u5173/|http://admin:1234567890@\u7f51\u5173/|http://admin:66668888@\u7f51\u5173/|http://admin:888888@\u7f51\u5173/|http://admin:88888888@\u7f51\u5173/|http://admin:666666@\u7f51\u5173/|http://admin:987654321@\u7f51\u5173/|http://admin:147258369@\u7f51\u5173/|http://admin:789456123@\u7f51\u5173/|http://admin:66666666@\u7f51\u5173/|http://admin:112233@\u7f51\u5173/|http://admin:111111@\u7f51\u5173/|http://admin:000000@\u7f51\u5173/|http://admin:5201314@\u7f51\u5173/|http://admin:789456123@\u7f51\u5173/|http://admin:123123@\u7f51\u5173/|http://admin:87654321@\u7f51\u5173/|http://admin:520520@\u7f51\u5173/|http://admin:123456789a@\u7f51\u5173/|http://admin:110110@\u7f51\u5173/|http://admin:110120@\u7f51\u5173/

这个Java文件的1439行定义了一个fixedm_897()的函数。从函数的代码可以看出，通过获取浏览器标题，并与其它字符串进行匹配。最后将用户名密码字符串以“@”拆分开。

![](http://p3.pstatp.com/large/141d0006350490b4039d)

『程序代码分析』

并利用JavaScript代码获取页面的一些id和tagname，模拟点击登录，自动提交用户名和密码尝试登录。

![](http://p3.pstatp.com/large/149b000012afc5da9803)

![](http://p3.pstatp.com/large/149e00026a52412499be)

![](http://p2.pstatp.com/large/149b000012b1c4aaffd0)

『程序代码分析』

登录成功后，通过获取修改DNS的元素id，修改为101.200.147.153和8.8.8.8。

![](http://p3.pstatp.com/large/141d000635055e7e31b1)

『程序代码分析』

这个恶意程序的大体工作流程就是这个样子。在分析完成这个文件后，尝试着搜索了相关的域名，“www.dochtm.com”，结果发现程序在向下面这个链接发送系统的mac地址信息。

![](http://p1.pstatp.com/large/149a0003f7114a1f5fee)

『程序发送mac地址代码』

在浏览器中打开这个链接，显示一片空白。

![](http://p3.pstatp.com/large/149b000012b23d876cfe)

『网页访问界面』

尝试把后面的字符串删掉，访问“http://www.dochtm.com/user”，结果显示了该程序生命周期内的所有连接用户和激活用户数量。

![](http://p3.pstatp.com/large/149a0003f7129501546c)

『感染样本数量统计情况』

9月份：

![](http://p1.pstatp.com/large/149f000012b69dd8e012)

『9月感染样本统计』

10月份：

![](http://p3.pstatp.com/large/149e00026a55fb0c6f2e)

『10月感染样本统计』

11月份：

![](http://p9.pstatp.com/large/149e00026a548971a6f4)

『11月感染样本统计』

12月份：

![](http://p3.pstatp.com/large/149f000012b745ce6f73)

『12月感染样本统计』

截止12月31号，已有1428个用户被木马成功感染。

有趣的是，在访问上面的链接时，Server为Microsoft-IIS/6.0，有两个X-Powered-By，这说明恶意程序开发者有意隐藏网站的一些信息。但是从链接的形式来看，更像是php的程序。

![](http://p1.pstatp.com/large/149a0003f713761e6421)

『网页header信息』

在原URL后加上index.php，仍旧可以访问。

![](http://p3.pstatp.com/large/142100080503ffc1cecc)

『网页界面』

通过尝试这个域名的ftp登录，发现这个账号并不是常用ftp端口21，而是22。这里也可以看出来，连接的目标主机是Windows系统。

![](http://p3.pstatp.com/large/141d000635067841ff21)

『ftp连接返回信息』

也尝试了telnet远程连接。。。但是并没有成功。。

0x04 究竟谁是幕后黑手？

这个恶意程序的开发人员很有趣。在做了以上的尝试后，我们又回去看了看反编译的安卓木马。

![](http://p1.pstatp.com/large/149f000012b8fd73cec3)

『木马程序src文件目录』

除了主要木马关键代码，还有个e4a和umeng。

通过搜索发现，这个e4a是一个名为易安卓的中文可视化编程语言，和易语言仿佛有异曲同工之妙。

![](http://p1.pstatp.com/large/149f000012b9101fa58e)

『e4a搜索结果』

友盟（umeng）是一个提供从基础设置搭建-开发-运营服务的整合服务平台。想必开发者利用友盟进行数据统计分析。

程序的assets目录的图片并不是由ico组成的，而是由各种png、jpg文件拼凑而成的，再由坐标定位到指定的位置进行展示。这充分说明，这并不是一个重打包的仿冒应用程序，而是一个完完全全重新开发的仿冒应用程序。

![](http://p3.pstatp.com/large/149b000012b3c0795259)

『assets目录文件』

当然，这个开发者能够想着用图片拼接的方式仿冒应用也是脑洞很大的，还用了一些技术手段防止网站服务器信息泄露。

![](http://p3.pstatp.com/large/149a0003f70b5b8e96ab)

“百度一下”，个人数据广而告之

![](http://p1.pstatp.com/large/14210008050017549d06)

这个恶意程序和“万能助手”的主要功能是一样的，都是修改路由器的DNS信息。有点不一样的是，这个“百度一下”在获取到路由器的地区线路信息后，通过对比，修改为不同线路的DNS服务器地址。具体的代码如下图所示：

![](http://p3.pstatp.com/large/149b000012b47004faa0)

『程序代码分析』

当线路为联通时，修改DNS为“101.200.147.153”；当线路为移动时，修改DNS为“112.33.13.11”；当线路为电信时，修改DNS为“120.76.249.59”。

当用户使用该软件时，依旧可以正常用作搜索，但是流量被修改后的DNS劫持。

![](http://p3.pstatp.com/large/149a0003f70b5b8e96ab)

“中毒”了可怎么办？

![](http://p1.pstatp.com/large/14210008050017549d06)

如果不知道自己是否中招了，可以在路由器中查看DNS信息是否被篡改为以下其中之一：

101.200.147.153112.33.13.11120.76.249.59

或者查看手机中应用程序的版本号信息，恶意程序的版本号信息与官方程序的版本号存在偏差，可以作为一个判断标准。

如果DNS已经被修改，或者应用程序版本号信息有误，建议卸载手机中的木马程序，修改路由器DNS信息即可。

![](http://p3.pstatp.com/large/149a0003f70b5b8e96ab)

一些安全小tip

![](http://p1.pstatp.com/large/14210008050017549d06)

如果在安装程序时不清楚程序的安全性，可以将程序上传到Janus平台，查看应用程序是否涉及敏感权限或者异常域名、IP等信息。