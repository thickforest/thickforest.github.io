---
layout: post
title: Tlog：录制/播放终端 IO 和会话的工具 | Linux 中国
categories:
- Pocket
tags:
---
原文地址：http://mp.weixin.qq.com/s/0zOV7pF-h6whx0hmH8hppw

收藏时间：2018-03-24 04:49:25

<div  lang="zh">
            
                        <div id="img-content" nodeIndex="5">
                
                
                <p class="profile_meta _RIL_KEEPER_CLASS_" nodeIndex="10">
                            <label class="profile_meta_label">微信号</label>
                            <span class="profile_meta_value">linux-cn</span>
                            </p><p class="profile_meta _RIL_KEEPER_CLASS_" nodeIndex="11">
                            <label class="profile_meta_label">功能介绍</label>
                            <span class="profile_meta_value">十万级技术订阅号，依托于『Linux中国』（https://linux.cn/）社区，专注于 Linux 学习、技术研究、开源思想传播。</span>
                            </p>
                
                
                
                
                                                
                                                                
                
                <div class="rich_media_content " id="js_content" nodeIndex="12">
                    

                    

                    
                    
                    <div id="RIL_IMG_1" class="RIL_IMG"><img src="/media/posts_images/2018-03-24-2126835636/1"/></div><p class=" _RIL_KEEPER_CLASS_" nodeIndex="13"><br nodeIndex="109"></p><nav class="bm" nodeIndex="108"><section class="bm_h" nodeIndex="110">有用的原文链接</section><section class="bm_c" nodeIndex="111">请访问文末的“<span nodeIndex="112">原文链接</span>”获得可点击的文内链接、全尺寸原图和相关文章。</section></nav><p class=" _RIL_KEEPER_CLASS_" nodeIndex="14"><br nodeIndex="113"></p><section class="bm" nodeIndex="114"><section class="bm_h" nodeIndex="115">致谢</section><section class="bm_c" nodeIndex="116"><span nodeIndex="117">编译自　|　https://linoxide.com/linux-how-to/tlog-tool-record-play-terminal-io-sessions/</span> <br nodeIndex="118"><span nodeIndex="119">　作者　|　Saheetha Shameer</span><br nodeIndex="120"><span nodeIndex="121">　译者　|　geekpi 💎 💎 共计翻译：<span class="num" nodeIndex="122">680</span> 篇 贡献时间：1610 天</span></section></section><section nodeIndex="16"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="15">Tlog 是 Linux 中终端 I/O 录制和回放软件包。它用于实现一个集中式用户会话录制。它将所有经过的消息录制为 JSON 消息。录制为 JSON 格式的主要目的是将数据传送到 ElasticSearch 之类的存储服务，可以从中搜索和查询，以及回放。同时，它们保留所有通过的数据和时序。</p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="17">Tlog 包含三个工具，分别是 <code nodeIndex="123">tlog-rec</code>、tlog-rec-session<code nodeIndex="124">和</code>tlog-play`。</p><section class="ul" nodeIndex="125"><section class="ulli" nodeIndex="126">◈ <code nodeIndex="127">tlog-rec</code> 工具一般用于录制终端、程序或 shell 的输入或输出。</section><section class="ulli" nodeIndex="128">◈ <code nodeIndex="129">tlog-rec-session</code> 工具用于录制整个终端会话的 I/O，包括录制的用户。</section><section class="ulli" nodeIndex="130">◈ <code nodeIndex="131">tlog-play</code> 工具用于回放录制。</section></section><p class=" _RIL_KEEPER_CLASS_" nodeIndex="18">在本文中，我将解释如何在 CentOS 7.4 服务器上安装 Tlog。</p><p class="h3 _RIL_KEEPER_CLASS_" nodeIndex="19">安装</p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="20">在安装之前，我们需要确保我们的系统满足编译和安装程序的所有软件要求。在第一步中，使用以下命令更新系统仓库和软件包。</p><pre class="prettyprint linenums prettyprinted" nodeIndex="21"><ol class="linenums list-paddingleft-2 _RIL_KEEPER_CLASS_" nodeIndex="23"><li nodeIndex="22"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="24"><code><span class="com">#</span><span class="pln"> </span><span class="kwd">yum</span><span class="pln"> update</span></code></p></li></ol></pre><p class=" _RIL_KEEPER_CLASS_" nodeIndex="25">我们需要安装此软件安装所需的依赖项。在安装之前，我已经使用这些命令安装了所有依赖包。</p><pre class="prettyprint linenums prettyprinted" nodeIndex="26"><ol class="linenums list-paddingleft-2 _RIL_KEEPER_CLASS_" nodeIndex="28"><li nodeIndex="27"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="29"><code><span class="com">#</span><span class="pln"> </span><span class="kwd">yum</span><span class="pln"> install </span><span class="kwd">wget</span><span class="pln"> </span><span class="kwd">gcc</span></code></p></li><li nodeIndex="30"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="31"><code><span class="com">#</span><span class="pln"> </span><span class="kwd">yum</span><span class="pln"> install </span><span class="kwd">systemd</span><span class="pun">-</span><span class="pln">devel json</span><span class="pun">-</span><span class="pun">-</span><span class="pln">cdevel libcurl</span><span class="pun">-</span><span class="pln">devel m4</span></code></p></li></ol></pre><p class=" _RIL_KEEPER_CLASS_" nodeIndex="32">完成这些安装后，我们可以下载该工具的<span nodeIndex="132">源码包</span><span class="sup" nodeIndex="133">[1]</span>并根据需要将其解压到服务器上：</p><pre class="prettyprint linenums prettyprinted" nodeIndex="33"><ol class="linenums list-paddingleft-2 _RIL_KEEPER_CLASS_" nodeIndex="35"><li nodeIndex="34"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="36"><code><span class="com">#</span><span class="pln"> </span><span class="kwd">wget</span><span class="pln"> https</span><span class="pun">:</span><span class="com">//github.com/Scribery/tlog/releases/download/v3/tlog-3.tar.gz</span></code></p></li><li nodeIndex="37"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="38"><code><span class="com">#</span><span class="pln"> </span><span class="kwd">tar</span><span class="pln"> </span><span class="pun">-</span><span class="pln">xvf tlog</span><span class="pun">-</span><span class="lit">3.tar</span><span class="pun">.</span><span class="pln">gz</span></code></p></li><li nodeIndex="39"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="40"><code><span class="com">#</span><span class="pln"> </span><span class="kwd">cd</span><span class="pln"> tlog</span><span class="pun">-</span><span class="lit">3</span></code></p></li></ol></pre><p class=" _RIL_KEEPER_CLASS_" nodeIndex="41">现在，你可以使用我们通常的配置和编译方法开始构建此工具。</p><pre class="prettyprint linenums prettyprinted" nodeIndex="42"><ol class="linenums list-paddingleft-2 _RIL_KEEPER_CLASS_" nodeIndex="44"><li nodeIndex="43"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="45"><code><span class="com">#</span><span class="pln"> </span><span class="pun">./</span><span class="pln">configure </span><span class="pun">--</span><span class="pln">prefix</span><span class="pun">=</span><span class="str">/usr --sysconfdir=/</span><span class="pln">etc </span><span class="pun">&&</span><span class="pln"> </span><span class="kwd">make</span></code></p></li><li nodeIndex="46"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="47"><code><span class="com">#</span><span class="pln"> </span><span class="kwd">make</span><span class="pln"> install</span></code></p></li><li nodeIndex="48"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="49"><code><span class="com">#</span><span class="pln"> ldconfig</span></code></p></li></ol></pre><p class=" _RIL_KEEPER_CLASS_" nodeIndex="50">最后，你需要运行 <code nodeIndex="134">ldconfig</code>。它对命令行中指定目录、<code nodeIndex="135">/etc/ld.so.conf</code> 文件，以及信任的目录（ <code nodeIndex="136">/lib</code> 和 <code nodeIndex="137">/usr/lib</code>）中最近的共享库创建必要的链接和缓存。</p><p class="h3 _RIL_KEEPER_CLASS_" nodeIndex="51">Tlog 工作流程图</p><p class="article_img _RIL_KEEPER_CLASS_" nodeIndex="52"><div id="RIL_IMG_2" class="RIL_IMG"><img src="/media/posts_images/2018-03-24-2126835636/2"/></div></p><p class="article_img_desc _RIL_KEEPER_CLASS_" nodeIndex="53"><em nodeIndex="138">Tlog working process</em></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="54">首先，用户通过 PAM 进行身份验证登录。名称服务交换器（NSS）提供的 <code nodeIndex="139">tlog</code> 信息是用户的 shell。这初始化了 tlog 部分，并从环境变量/配置文件收集关于实际 shell 的信息，并在 PTY 中启动实际的 shell。然后通过 syslog 或 sd-journal 开始录制在终端和 PTY 之间传递的所有内容。</p><p class="h3 _RIL_KEEPER_CLASS_" nodeIndex="55">用法</p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="56">你可以使用 <code nodeIndex="140">tlog-rec</code> 录制一个会话并使用 <code nodeIndex="141">tlog-play</code> 回放它，以测试新安装的 tlog 是否能够正常录制和回放会话。</p><p class="h4 _RIL_KEEPER_CLASS_" nodeIndex="57">录制到文件中</p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="58">要将会话录制到文件中，请在命令行中执行 <code nodeIndex="142">tlog-rec</code>，如下所示：</p><pre class="prettyprint linenums prettyprinted" nodeIndex="59"><ol class="linenums list-paddingleft-2 _RIL_KEEPER_CLASS_" nodeIndex="61"><li nodeIndex="60"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="62"><code><span class="pln">tlog</span><span class="pun">-</span><span class="pln">rec </span><span class="pun">--</span><span class="pln">writer</span><span class="pun">=</span><span class="kwd">file</span><span class="pln"> </span><span class="pun">--</span><span class="kwd">file</span><span class="pun">-</span><span class="pln">path</span><span class="pun">=</span><span class="pln">tlog</span><span class="pun">.</span><span class="pln">log</span></code></p></li></ol></pre><p class=" _RIL_KEEPER_CLASS_" nodeIndex="63">该命令会将我们的终端会话录制到名为 <code nodeIndex="143">tlog.log</code> 的文件中，并将其保存在命令中指定的路径中。</p><p class="h4 _RIL_KEEPER_CLASS_" nodeIndex="64">从文件中回放</p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="65">你可以在录制过程中或录制后使用 <code nodeIndex="144">tlog-play</code> 命令回放录制的会话。</p><pre class="prettyprint linenums prettyprinted" nodeIndex="66"><ol class="linenums list-paddingleft-2 _RIL_KEEPER_CLASS_" nodeIndex="68"><li nodeIndex="67"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="69"><code><span class="pln">tlog</span><span class="pun">-</span><span class="pln">play </span><span class="pun">--</span><span class="pln">reader</span><span class="pun">=</span><span class="kwd">file</span><span class="pln"> </span><span class="pun">--</span><span class="kwd">file</span><span class="pun">-</span><span class="pln">path</span><span class="pun">=</span><span class="pln">tlog</span><span class="pun">.</span><span class="pln">log</span></code></p></li></ol></pre><p class=" _RIL_KEEPER_CLASS_" nodeIndex="70">该命令从指定的路径读取先前录制的文件 <code nodeIndex="145">tlog.log</code>。</p><p class="h3 _RIL_KEEPER_CLASS_" nodeIndex="71">总结</p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="72">Tlog 是一个开源软件包，可用于实现集中式用户会话录制。它主要是作为一个更大的用户会话录制解决方案的一部分使用，但它被设计为独立且可重用的。该工具可以帮助录制用户所做的一切，并将其存储在服务器的某个位置，以备将来参考。你可以从这个<span nodeIndex="146">文档</span><span class="sup" nodeIndex="147">[2]</span>中获得关于这个软件包使用的更多细节。我希望这篇文章对你有用。请发表你的宝贵建议和意见。</p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="73"><span nodeIndex="148">关于 Saheetha Shameer （作者）</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="74">我正在担任高级系统管理员。我是一名快速学习者，有轻微的倾向跟随行业中目前和正在出现的趋势。我的爱好包括听音乐、玩策略游戏、阅读和园艺。我对尝试各种美食也有很高的热情 :-)</p><hr nodeIndex="149"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="75">via: <span nodeIndex="150">https://linoxide.com/linux-how-to/tlog-tool-record-play-terminal-io-sessions/</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="76">作者：<span nodeIndex="151">Saheetha Shameer</span><span class="sup" nodeIndex="152">[4]</span> 译者：<span nodeIndex="153">geekpi</span> 校对：<span nodeIndex="154">wxy</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="77">本文由 <span nodeIndex="155">LCTT</span> 原创编译，<span nodeIndex="156">Linux中国</span> 荣誉推出</p></section><p class=" _RIL_KEEPER_CLASS_" nodeIndex="78"><br nodeIndex="157"></p>
                </div>
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" nodeIndex="79"></div>

                
                                <p class=" _RIL_KEEPER_CLASS_" nodeIndex="83">
                        
                        <a class="reward_access" id="js_reward_link" href=""><span class="icon-reward"></span><span id="js_reward_link_text">赞赏</span></a>
                        
                    </p><p class="tips_global reward_user_tips _RIL_KEEPER_CLASS_" nodeIndex="85"><a href="" id="js_reward_total"></a>人赞赏</p><div id="RIL_IMG_3" class="RIL_IMG"><img src="/media/posts_images/2018-03-24-2126835636/3"/></div>
                                <p class="tips_global _RIL_KEEPER_CLASS_" nodeIndex="88">长按二维码向我转账</p><p class="reward_tips _RIL_KEEPER_CLASS_" nodeIndex="89"></p><p class="tips_global _RIL_KEEPER_CLASS_" nodeIndex="90">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                                            </div>
                        
                        


                    </div>