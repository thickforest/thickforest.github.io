<div class="article-content"><div><p><img alt="Ubuntu | 如何加快开机启动" img_height="500" img_width="900" onerror="javascript:errorimg.call(this);" src="http://p1.pstatp.com/large/ac800073da9b5550968"/></p><p>自从将公司电脑的Ubuntu系统升级到了Ubuntu 16.04 (之前是15.04), 每次开机竟然耗时2分钟左右, 简直不能忍! 咋能向Windows看齐(Windows都没这么慢好嘛), 话说以前的Macbook Pro高配开机只要2秒钟...</p><p>那么如何找出拖慢开机速度的元凶并将其禁用呢?</p><p>systemd自带分析利器systemd-analyze</p><p>systemd-analyze有一些参数，大体上来讲就是一些功能, 可以用</p><p>man systemd-analyze</p><p>来看看:</p><p><img alt="Ubuntu | 如何加快开机启动" img_height="939" img_width="1863" onerror="javascript:errorimg.call(this);" src="http://p3.pstatp.com/large/b0a00043c640655af2b"/></p><p>其中, 对我们比较有用的参数就是blame。</p><p>blame : blame是"指责"的意思。</p><p>如果你平时使用git来进行版本控制, 那你应该知道有个命令叫</p><p>git blame</p><p>用git blame加文件名就可以看到文件中每一行最近是谁更改的。</p><p>同理, systemd-analyze blame就是显示开机启动项的时间, 从最慢依次列出。</p><p>systemd-analyze blame</p><p><img alt="Ubuntu | 如何加快开机启动" img_height="331" img_width="484" onerror="javascript:errorimg.call(this);" src="http://p3.pstatp.com/large/b0d0004f63841d29b28"/></p><p>可以看到, 最慢的启动项是NetworkManager-wait-online.service, 竟然用了30秒, 不能忍!</p><p>禁用之:</p><p>sudo systemctl disable NetworkManager-wait-online.service</p><p><img alt="Ubuntu | 如何加快开机启动" img_height="78" img_width="903" onerror="javascript:errorimg.call(this);" src="http://p3.pstatp.com/large/ac70007fa3b7e039b2d"/></p><p>其实, 昨天我还禁用了两个启动项, 都是fstab中的, 用于挂载(mount)服务器上的nfs磁盘, 每一个竟然用了1分钟左右 (用systemd-analyze blame看到的):</p><p>sudo vim /etc/fstab</p><p><img alt="Ubuntu | 如何加快开机启动" img_height="361" img_width="880" onerror="javascript:errorimg.call(this);" src="http://p3.pstatp.com/large/b0c0004fc659a691d43"/></p><p>就是上图中</p><p>172.19.0.133:/mnt/androidstorage/NFS_RO /mnt/nfs_ro</p><p>172.19.0.133:/mnt/androidstorage/NFS_RW /mnt/nfs_rw</p><p>那两行, 表示</p><p>把远端服务器172.19.0.133上的/mnt/androidstorage/NFS_RO挂载(sudo mount)到本机的/mnt/nfs_ro</p><p>把远端服务器172.19.0.133上的/mnt/androidstorage/NFS_RW挂载(sudo mount)到本机的/mnt/nfs_rw</p><p>如何禁用呢?</p><p>在options那一列中加上 noauto即可, 表示不自动启动。</p><p>auto是automatic的缩写, 表示"自动"。而noauto就是not/no automatic的缩写, 表示"不自动"。</p><p><img alt="Ubuntu | 如何加快开机启动" img_height="358" img_width="900" onerror="javascript:errorimg.call(this);" src="http://p2.pstatp.com/large/b0e0004f3e8437b221a"/></p><p>用man fstab可以看到:</p><p><img alt="Ubuntu | 如何加快开机启动" img_height="941" img_width="1881" onerror="javascript:errorimg.call(this);" src="http://p1.pstatp.com/large/ac8000740b1ca4e548a"/><br/></p><p><img alt="Ubuntu | 如何加快开机启动" img_height="383" img_width="1824" onerror="javascript:errorimg.call(this);" src="http://p3.pstatp.com/large/b0e0004f64645ae91b5"/></p>可以看到, 默认情况下(default中)是auto的, 也就是说默认情况下会在开机时自动挂载那两个nfs磁盘。<p>如此处理之后, 再次重启电脑:</p><p>sudo reboot</p><p>这回, 电脑启动只要几秒啦!</p><p>所以, 如果想加快开机启动, 只要先用</p><p>systemd-analyze blame</p><p>列出开机启动项的时间, 然后禁用那些很慢的即可, 不过也要小心, 不要近用了系统的关键启动项。</p></div><p class="footnote">本文为头条号作者原创。未经授权，不得转载。</p></div>
