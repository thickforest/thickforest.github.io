---
layout: post
title: 使用Empire“探索”Windows个人电脑
categories:
- Pocket
tags:
---
原文地址：http://mp.weixin.qq.com/s/aLnXJaD7DYf1SLcYfEvEZQ

收藏时间：2017-04-28 11:51:33

<div  lang="zh">
                <div id="img-content" class="rich_media_area_primary" nodeIndex="6">
                    
                    <p class="profile_meta _RIL_KEEPER_CLASS_" nodeIndex="11">
                                <label class="profile_meta_label">微信号</label>
                                <span class="profile_meta_value">freebuf</span>
                                </p><p class="profile_meta _RIL_KEEPER_CLASS_" nodeIndex="12">
                                <label class="profile_meta_label">功能介绍</label>
                                <span class="profile_meta_value">国内关注度最高的全球互联网安全新媒体</span>
                                </p>
                    
                    
                    
                    
                                                            
                                                            
                    
                    <div class="rich_media_content " id="js_content" nodeIndex="13">
                        

                        

                        
                        
                        <p class=" _RIL_KEEPER_CLASS_" nodeIndex="14"><span nodeIndex="121">* 原创作者：amandus，本文属FreeBuf原创奖励计划，转载请注明来自FreeBuf.COM</span></p><section class="RankEditor" nodeIndex="122"><section nodeIndex="123"><section nodeIndex="124"></section><section nodeIndex="16"><p class=" _RIL_KEEPER_CLASS_" nodeIndex="15"><span nodeIndex="125">Empire是针对windows平台的一套渗透工具，包括了从stager生成、提权到渗透维持的一系列功能。笔者早先在试用Empire的过程中发现其不适用于UTF-8编码，所以在执行命令时包含中文就会卡死。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="17"><span nodeIndex="126">近期Empire的作者解决了以上bug，所以让我们愉快地使用Empire探索一番。</span></p></section><section nodeIndex="127"></section></section></section><p class=" _RIL_KEEPER_CLASS_" nodeIndex="18"><br nodeIndex="128"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="19"><span nodeIndex="129">对于Empire的全部功能可以参考官方网站：</span><span nodeIndex="130">http://www.powershellempire.com/</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="20"><span nodeIndex="131"><br nodeIndex="132"></span></p><section class="RankEditor" nodeIndex="133"><section nodeIndex="134"><section nodeIndex="135"></section><section nodeIndex="22"><p class="title white _RIL_KEEPER_CLASS_" nodeIndex="21">1、安装</p></section></section><section nodeIndex="136"></section></section><p class=" _RIL_KEEPER_CLASS_" nodeIndex="23"><br nodeIndex="137"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="24"><span nodeIndex="138">虽然渗透的目标是windows，但Empire本身应该是运行在linux平台的，首先把程序目录下载下来：</span><br nodeIndex="139"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="25"><div id="RIL_IMG_1" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/1"/></div></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="26"><span nodeIndex="140">转进”Empire/setup”目录，安装./install.sh。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="27"><div id="RIL_IMG_2" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/2"/></div></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="28"><span nodeIndex="141">Empire的安装和运行都需要管理员权限，所以不要忘记加上sudo。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="29"><span nodeIndex="142">如果安装不成功，可能的原因是python环境配置不完整，笔者使用debian系统，重装python、pip、python3和pip3搞定。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="30"><span nodeIndex="143"><br nodeIndex="144"></span></p><section class="RankEditor" nodeIndex="145"><section nodeIndex="146"><section nodeIndex="147"></section><section nodeIndex="32"><p class="title white _RIL_KEEPER_CLASS_" nodeIndex="31">2、生成Listener</p></section></section><section nodeIndex="148"></section></section><p class=" _RIL_KEEPER_CLASS_" nodeIndex="33"><span nodeIndex="149">主目录下运行empire可以进入界面：</span><br nodeIndex="150"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="34"><div id="RIL_IMG_3" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/3"/></div></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="35"><span nodeIndex="151">风格十分简单：</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="36"><a class="highslide-image" target="_blank" nodeIndex="152"><div id="RIL_IMG_4" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/4"/></div></a></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="37"><span nodeIndex="153">Empire中help命令几乎可以得到一切信息：</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="38"><a class="highslide-image" target="_blank" nodeIndex="154"><div id="RIL_IMG_5" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/5"/></div></a></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="39"><span nodeIndex="155">输入</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="40"><div id="RIL_IMG_6" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/6"/></div></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="41"><span nodeIndex="156">进入监听线程界面，使用</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="42"><div id="RIL_IMG_7" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/7"/></div></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="43"><span nodeIndex="157">查看如何操作：</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="44"><a class="highslide-image" target="_blank" nodeIndex="158"><div id="RIL_IMG_8" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/8"/></div></a></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="45"><span nodeIndex="159">注意到主要应该修改Name和Host，命令为：</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="46"><div id="RIL_IMG_9" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/9"/></div></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="47"><span nodeIndex="160">之后运行</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="48"><div id="RIL_IMG_10" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/10"/></div></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="49"><span nodeIndex="161">即可生成线程。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="50"><span nodeIndex="162"><br nodeIndex="163"></span></p><section class="RankEditor" nodeIndex="164"><section nodeIndex="165"><section nodeIndex="166"></section><section nodeIndex="52"><p class="title white _RIL_KEEPER_CLASS_" nodeIndex="51">3、生成stager</p></section></section><section nodeIndex="167"></section></section><p class=" _RIL_KEEPER_CLASS_" nodeIndex="53"><span nodeIndex="168">接下来生成在目标机器上运行的stager。</span><br nodeIndex="169"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="54"><span nodeIndex="170">Empire提供了多种选项：</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="55"><a class="highslide-image" target="_blank" nodeIndex="171"><div id="RIL_IMG_11" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/11"/></div></a></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="56"><span nodeIndex="172">个人认为一般情况下launcher_vbs和macro是使用比较多的，前者会生成可以直接运行的vbs代码，后者可以粘贴进office文档中。实战中可以通过伪装诱导渗透对象打开vbs文件，或者在excel/doc中加入有效信息（如特殊的表格或者数学公式）诱导用户点击“运行宏”。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="57"><span nodeIndex="173">以launcher_vbs的使用为例，其选项包括：</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="58"><a class="highslide-image" target="_blank" nodeIndex="174"><div id="RIL_IMG_12" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/12"/></div></a></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="59"><span nodeIndex="175">可见主要需要修改的是Listener，通过</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="60"><div id="RIL_IMG_13" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/13"/></div></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="61"><span nodeIndex="176">设置好，运行<br nodeIndex="177"></span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="62"><div id="RIL_IMG_14" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/14"/></div></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="63"><span nodeIndex="178">生成。默认生成在/tmp/文件夹下。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="64"><span nodeIndex="179">在个人电脑上使用scp下载launcher_vbs：</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="65"><div id="RIL_IMG_15" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/15"/></div></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="66"><span nodeIndex="180">此后这个文件可以保存在u盘里随时使用了。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="67"><span nodeIndex="181"><br nodeIndex="182"></span></p><section class="RankEditor" nodeIndex="183"><section nodeIndex="184"><section nodeIndex="185"></section><section nodeIndex="69"><p class="title white _RIL_KEEPER_CLASS_" nodeIndex="68">4、探索渗透目标</p></section></section><section nodeIndex="186"></section></section><p class=" _RIL_KEEPER_CLASS_" nodeIndex="70"><span nodeIndex="187">如果目标在电脑中双击了launcher_vbs，服务器端会有反馈提示：</span><br nodeIndex="188"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="71"><a class="highslide-image" target="_blank" nodeIndex="189"><div id="RIL_IMG_16" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/16"/></div></a></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="72"><span nodeIndex="190">help命令看一眼能够做什么：</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="73"><a class="highslide-image" target="_blank" nodeIndex="191"><div id="RIL_IMG_17" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/17"/></div></a></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="74"><span nodeIndex="192">事实上，此时已经可以使用cmd中的命令了：</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="75"><a class="highslide-image" target="_blank" nodeIndex="193"><div id="RIL_IMG_18" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/18"/></div></a></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="76"><a class="highslide-image" target="_blank" nodeIndex="194"><br nodeIndex="195"></a></p><section class="RankEditor" nodeIndex="196"><section nodeIndex="197"><section nodeIndex="198"></section><section nodeIndex="78"><p class="title white _RIL_KEEPER_CLASS_" nodeIndex="77">5、键盘记录</p></section></section><section nodeIndex="199"></section></section><p class=" _RIL_KEEPER_CLASS_" nodeIndex="79"><span nodeIndex="200">我们通过keylogger试验一下如何使用Empire的module。</span><br nodeIndex="201"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="80"><div id="RIL_IMG_19" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/19"/></div></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="81"><span nodeIndex="202">似乎也不用设置什么特别的，所以就直接run了：</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="82"><a class="highslide-image" target="_blank" nodeIndex="203"><div id="RIL_IMG_20" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/20"/></div></a></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="83"><span nodeIndex="204">不是每次按键都能记录清楚，且不能直接记录中文，但大概的意思还是很到位的。</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="84"><span nodeIndex="205"><br nodeIndex="206"></span></p><section class="RankEditor" nodeIndex="207"><section nodeIndex="208"><section nodeIndex="209"></section><section nodeIndex="86"><p class="title white _RIL_KEEPER_CLASS_" nodeIndex="85">6、小结</p></section></section><section nodeIndex="210"></section></section><p class=" _RIL_KEEPER_CLASS_" nodeIndex="87"><span nodeIndex="211">汉字处理的bug修复之后，感觉Empire已经成为了针对中国windows个人电脑的强力渗透工具。之后有待进一步研究的是渗透维持，虽然empire中已经集成了相应module，但是个人电脑相比于服务器，环境设置多变且没有固定ip，感觉还是有很多值得研究的地方。</span><br nodeIndex="212"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="88"><span nodeIndex="213"><br nodeIndex="214"></span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="89"><span nodeIndex="215"><strong class=" _RIL_KEEPER_CLASS_" nodeIndex="216">最后祝大家玩得愉快！</strong></span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="90"><span nodeIndex="217">* 原创作者：amandus，本文属FreeBuf原创奖励计划，转载请注明来自FreeBuf.COM</span></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="91"><div id="RIL_IMG_21" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/21"/></div></p>
                    </div>
                    <div class="ct_mpda_wrp" id="js_sponsor_ad_area" nodeIndex="92">

                    </div>

                    
                                        <p id="js_preview_reward_wording" class="tips_global reward_tips _RIL_KEEPER_CLASS_" nodeIndex="94"></p><p class=" _RIL_KEEPER_CLASS_" nodeIndex="95">
                            <a class="reward_access" id="js_preview_reward_link" href="">赞赏</a>
                        </p>
                    <p class="tips_global _RIL_KEEPER_CLASS_" nodeIndex="97">长按二维码向我转账</p><p id="js_preview_reward_ios_wording" class="reward_tips _RIL_KEEPER_CLASS_" nodeIndex="98"></p><p class="tips_global _RIL_KEEPER_CLASS_" nodeIndex="99">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                                        
                                        



                                    </div>

                

                <div class="rich_media_area_extra" nodeIndex="103">

                    
                                        <div class="mpda_bottom_container" id="js_bottom_ad_area" nodeIndex="104">
                        
                    </div>
                                        
                    <div id="js_iframetest" nodeIndex="105"></div>
                                        
                                        <p class="tips_global tc title_bottom_tips _RIL_KEEPER_CLASS_" id="js_cmt_nofans1" nodeIndex="109">该文章作者已设置需关注才可以留言</p><p class="discuss_icon_tips title_bottom_tips tr _RIL_KEEPER_CLASS_" id="js_cmt_addbtn1" nodeIndex="110" childisonlyalink="1">
                                
                                                                <a href="http://mp.weixin.qq.com/s/aLnXJaD7DYf1SLcYfEvEZQ" id="js_cmt_write1">写留言<div id="RIL_IMG_22" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/22"/></div></a>
                                                            </p><ul class="discuss_list _RIL_KEEPER_CLASS_" id="js_cmt_list"></ul><p class="discuss_icon_tips rich_split_tips tr _RIL_KEEPER_CLASS_" id="js_cmt_addbtn2" nodeIndex="112" childisonlyalink="1">
                            
                                                        <a href="http://mp.weixin.qq.com/s/aLnXJaD7DYf1SLcYfEvEZQ" id="js_cmt_write2">写留言</a>
                                                    </p><p class="rich_split_tips tc tips_global _RIL_KEEPER_CLASS_" id="js_cmt_tips" nodeIndex="113"></p><p class="rich_split_tips tc _RIL_KEEPER_CLASS_" id="js_cmt_qa" nodeIndex="116" childisonlyalink="1">
                            <a href="http://kf.qq.com/touch/sappfaq/150211YfyMVj150313qmMbyi.html?scene_id=kf264">
                                了解留言功能详情                            </a>
                        </p><div id="RIL_IMG_23" class="RIL_IMG"><img src="/media/posts_images/2017-04-28-1719862756/23"/></div></div></div>